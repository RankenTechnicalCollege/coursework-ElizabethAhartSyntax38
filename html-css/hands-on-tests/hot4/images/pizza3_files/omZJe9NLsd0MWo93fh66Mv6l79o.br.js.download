var CopilotSearch;(function(n){var t;(function(t){function kt(t){var p,w,d,tt,it,rt,ut,lt,yt,wt,bt,kt;(ft=t.locStrings.zeroInputSearchBoxAskMeAnything,et=t.locStrings.copilotSearchBoxFollowUp,i=_d.querySelector("#b_copilot_search .composer_wrapper textarea"),i)&&(f=_d.querySelector(".composer_wrapper .b_copilot_icon"),r=_d.querySelector("#b_copilot_search .b_copilot_send"),o=_d.querySelector("#b_copilot_search .b_copilot_stop_streaming"),a=_d.querySelector("#b_copilot_search .composer_inner_wrapper"),c=_d.querySelector("#b_copilot_search .composer_container"),e=(p=t.enableAttachment)!==null&&p!==void 0?p:!1,ot=(w=t.enableCopyButtonShow)!==null&&w!==void 0?w:!1,st=t.enableRewardsReportActivity,u=(d=t.isSERPVertical)!==null&&d!==void 0?d:!1,ht=(tt=t.goToSERP)!==null&&tt!==void 0?tt:!1,s=(it=t.enableSERPComposerNewTab)!==null&&it!==void 0?it:!1,at=(rt=t.enableSERPComposerInst)!==null&&rt!==void 0?rt:!1,ct=(ut=t.enableFeedbackShowAfterStreaming)!==null&&ut!==void 0?ut:!1,k=(lt=t.serpComposerFormCode)!==null&&lt!==void 0?lt:"",h=(yt=t.isMiniSERP)!==null&&yt!==void 0?yt:!1,vt=(wt=t.query)!==null&&wt!==void 0?wt:"",y=(bt=t.enableSideAlignedComposer)!==null&&bt!==void 0?bt:!1,l=(kt=t.enableSERPChat)!==null&&kt!==void 0?kt:!1,sj_be(i,"input",g),sj_be(i,"keypress",ri),sj_be(i,"focus",si),sj_be(i,"blur",hi),t.enableComposerPasteHandler&&n.ComposerPasteHandler&&sj_be(i,"paste",n.ComposerPasteHandler.onComposerPaste),e&&(n.AttachmentView.bindAttachmentEventsUI(),n.AttachmentDragDrop.initDragAndDrop()),sj_be(r,"click",function(t){n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.ComposerSubmitButtonClicked);pt(t)}),o&&sj_be(o,"click",function(){var t=n.Helper.getLastTurnId(),u={type:"CopilotSearchStreamingStop",data:{turnId:t}},i=n.Helper.getResponseId();CopilotSearchMessager.postMessageToTurn(t,i,u);n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.StopStreamingClick,"responseId",i);nt();ct&&n.TWrap.addFeedbackToTurn();r.disabled=!1;v=!1;n.Conversation.cleanUpTurnSpacing();n.ErrorState.errorHandler(n.ErrorState.ErrorType.STREAMSTOPPED);ot&&sj_evt.fire("ShellStopStreaming")}),y&&(window.addEventListener("resize",b),b()),n.ComposerMenu.init(u,s,k),t.enableModelSwitching&&n.ComposerModelSwitching.init(),sj_evt.bind("csTurnState",function(n){if(n&&n.length>1){var t=n[1];t=="start"?(r.disabled=!0,v=!0):(r.disabled=!1,v=!1)}}))}function dt(){return v}function p(){if(i){i.value="";i.style.height="auto";var t=n.getMode()===n.Helper.CopilotMode.Zero;t?i.setAttribute("placeholder",ft):i.setAttribute("placeholder",et);o&&nt();f&&f.classList.remove(n.Helper.hiddenClassName);u&&(l&&w(),sj_evt.fire(it));r.classList.add(n.Helper.hiddenClassName);d()}}function gt(){sj_evt.fire("csTurnState","reset")}function d(){a&&a.classList.remove(ut)}function yt(){p();w()}function ni(){var t=_qs("#b_copilot_search .chip_btn.back_btn");sj_be(t,"click",function(){n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.BackButtonClicked);n.changeMode(n.Helper.CopilotMode.Turn)});p();w()}function w(){setTimeout(function(){i&&i.focus()},0)}function ti(){}function ii(t){var i=n.Helper.CopilotSearchState;t===i.Error?ti():t===i.FloatingZeroPage?ni():t===i.FloatCompose?yt():t===i.BlankInput&&yt()}function g(){var t;if(i){i.value===""?r.classList.add(n.Helper.hiddenClassName):r.classList.remove(n.Helper.hiddenClassName);t=1;i.setAttribute("rows",t.toString());var u=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-top").split("px")[0])||12,f=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-bottom").split("px")[0])||12,o=parseInt(window.getComputedStyle(i,null).getPropertyValue("line-height").split("px")[0])||22;t=Math.max(1,Math.ceil((i.scrollHeight-u-f)/o));(t>1||e&&n.AttachmentManager.hasAttachment())&&a.classList.add(ut);requestAnimationFrame(function(){e&&n.AttachmentView.autoSizeAttachmentContainerUI();i.style.height="auto";i.style.height=i.scrollHeight+"px";e&&n.AttachmentView.resizeAttachmentUI(i.scrollHeight)})}}function ri(t){t.shiftKey||t.key!=="Enter"||pt(t);t.shiftKey&&t.key==="Enter"&&(t.preventDefault(),!i.value||tt.test(i.value)||(i.value+="\r\n",g()));t.key!="Enter"&&u&&!lt&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"ComposerInput"),lt=!0)}function pt(t){var f,o;t.preventDefault();!i.value||tt.test(i.value)||r.disabled!==!1||((u||l||h)&&typeof Log!="undefined"&&Log.LogFilterFlare&&Log.LogFilterFlare(["webco_composersubmit"]),!l&&(u||h)?(f=i.value.trim(),n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"ComposerSubmit","query",f),ht?fi(f):ei(f)):(o=n.getMode()===n.Helper.CopilotMode.Zero,l&&n.Helper.getLastTurnId()==null&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationStarted,"convId",n.Helper.getConversationId()),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.ConversationStart)),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart),o&&(n.changeMode(n.Helper.CopilotMode.Turn),n.ZeroPage.hide()),n.Conversation.generateCopilotResponse(i.value,n.Helper.InputTypes.Text),o&&typeof sj_rra!="undefined"&&st&&ui(),e&&n.AttachmentManager.clearAttachmentsData(),p()))}function ui(){var n=new URL(_d.URL);n.searchParams.set("turnindex","1");sj_rra(n.toString())}function fi(n){var i=_ge("sb_form_q"),r=_ge("sb_form"),t,u;!s&&i&&r?(i.value=n,t=_ge("sb_form_go"),t?t.click():r.submit()):(u=window.location.origin+"/search?q="+n+"&FORM=QBRE",window.open(u,s?"_blank":"_self"))}function ei(n){var i=window.location.origin+"/copilotsearch?q="+n+"&pq="+oi()+"&FORM="+k,t;h&&(i+="&webcoms=1");at?(t=_ge("b_bop_cs_inst"),t&&typeof si_ct=="function"?(t.href=i,t.target=s?"_blank":"_self",window.si_ct(t),t.click()):wt(i)):wt(i)}function wt(n){s||h?window.open(n,"_blank"):window.location.href=n}function oi(){if(h)return vt;var t=new URLSearchParams(window.location.search),n=t.get("q");return n?n.trim():""}function si(){f&&f.classList.add(n.Helper.hiddenClassName);u&&sj_evt.fire(it);i.value!==""&&r.classList.remove(n.Helper.hiddenClassName)}function hi(){i.value===""&&(r.classList.add(n.Helper.hiddenClassName),e&&n.AttachmentManager.hasAttachment()||(f&&f.classList.remove(n.Helper.hiddenClassName),u&&sj_evt.fire(bt),d()))}function b(){var f=_G.RTL,n=_qs(".b_copilot_search",_d),t=_qs(".composer_container",_d),i=_qs(".composer_side_aligned",_d),r,u;n&&t&&(i?f?(r=_d.body.clientWidth-n.getBoundingClientRect().right,i.style.right="".concat(r,"px")):(u=n.getBoundingClientRect().left,i.style.left="".concat(u,"px")):(t.style.right="0px",t.style.left="0px"))}function ci(){Lib.CssClass.remove(o,n.Helper.hiddenClassName)}function nt(){Lib.CssClass.add(o,n.Helper.hiddenClassName)}function li(){c&&y&&(Lib.CssClass.add(c,rt),b())}function ai(){c&&y&&(Lib.CssClass.remove(c,rt),b())}var i,tt=/^\s*$/,it="csComposerFocus",bt="csComposerBlur",rt="composer_side_aligned",f,r,o,a,c,ut="multiline",ft,et,e=!1,ot=!1,st=!1,u=!1,ht=!1,s=!1,ct=!1,k="",v=!1,lt=!1,at=!1,h=!1,vt="",y=!1,l=!1;t.initComposer=kt;t.getShouldDisableSubmit=dt;t.resetComposer=p;t.resetSubmitButtonStatus=gt;t.resetComposerLayoutDirection=d;t.focus=w;t.onUpdate=ii;t.resize=g;t.showStopStreamingButton=ci;t.hideStopStreamingButton=nt;t.showSideAlignComposer=li;t.hideSideAlignComposer=ai})(t=n.Composer||(n.Composer={}))})(CopilotSearch||(CopilotSearch={}))